---
title: A2A Agent
description: 在本地实例化一个远程以 A2A 服务部署的智能体，在本地调用运行。
navigation:
  icon: i-lucide-cloud
---

当智能体部署到云上后，可以在本地被初始化为一个 *Remote Agent*，能够通过 A2A 协议来访问的智能体。

## 使用方法

下面将使用 `uvicorn` 来启动一个本地的 A2A Server，体验 *Remote Agent* 使用方法。

::steps

### 编写 Server 侧智能体

我们将借助 Google ADK 的工具函数来便捷地创建一个 A2A Server：

```python [server_agent.py]
from veadk.a2a.utils.agent_to_a2a import to_a2a
from veadk import Agent
from veadk.tools.demo_tools import get_city_weather

agent = Agent(name="weather_reporter", tools=[get_city_weather])

app = to_a2a(agent)
```

::callout{icon="i-lucide-info"}
默认情况下，A2A Server 不启用认证功能。如果需要启用 VeADK 的认证和凭据管理功能，请参考下面的 [启用认证功能](#启用认证功能) 章节。
::

### 本地启动 A2A Server

```bash [Terminal]
uvicorn server_agent:app --host localhost --port 8001
```

### 编写 Client 侧智能体

```python [agent.py]
import asyncio

from veadk import Runner
from veadk.a2a.remote_ve_agent import RemoteVeAgent

remote_agent = RemoteVeAgent(name="a2a_agent", url="http://127.0.0.1:8001")

runner = Runner(remote_agent)
response = asyncio.run(runner.run("北京天气"))

print(response) # 北京天气晴朗，气温25°C。
```

::

## 启用认证功能

VeADK 提供了内置的认证和凭据管理功能，可以在 A2A Server 和 Client 之间进行安全的身份验证和凭据传递。

### Server 侧启用认证

在创建 A2A Server 时，通过设置 `enable_auth=True` 来启用认证功能：

```python [server_agent.py]
from veadk.a2a.utils.agent_to_a2a import to_a2a
from veadk import Agent
from veadk.tools.demo_tools import get_city_weather

agent = Agent(name="weather_reporter", tools=[get_city_weather])

# 启用 VeADK 认证功能
app = to_a2a(agent, enable_auth=True)
```

启用认证后，Server 会：
- 自动创建 `VeCredentialService` 来管理凭据
- 添加认证中间件来验证请求中的 token
- 支持凭据在 Server 和 Client 之间的安全传递

### 认证方式

`to_a2a` 支持两种认证方式，通过 `auth_method` 参数指定：

```python
# 方式 1: 从 HTTP Header 中提取 token (默认)
app = to_a2a(agent, enable_auth=True, auth_method="header")

# 方式 2: 从 Query String 中提取 token
app = to_a2a(agent, enable_auth=True, auth_method="querystring")
```


### Client 侧使用认证

当 Server 启用认证后，Client 侧的 `RemoteVeAgent` 会**自动处理认证**

## 初始化选项

### RemoteVeAgent 参数

::field-group
  ::field{name="name" type="string"}
  智能体的名称
  ::

  ::field{name="url" type="string"}
  远程智能体的访问端点
  ::
::

### to_a2a 参数

::field-group
  ::field{name="agent" type="BaseAgent" required}
  要转换为 A2A Server 的智能体实例
  ::

  ::field{name="host" type="string" default="localhost"}
  A2A Server 的主机地址
  ::

  ::field{name="port" type="int" default="8000"}
  A2A Server 的端口号
  ::

  ::field{name="protocol" type="string" default="http"}
  A2A Server 的协议（http 或 https）
  ::

  ::field{name="agent_card" type="AgentCard | string"}
  可选的智能体卡片对象或 JSON 文件路径。如果不提供，将自动从智能体生成
  ::

  ::field{name="runner" type="Runner"}
  可选的 Runner 对象。如果不提供，将自动创建默认 Runner
  ::

  ::field{name="enable_auth" type="bool" default="false"}
  是否启用 VeADK 认证功能。启用后会添加凭据服务和认证中间件
  ::

  ::field{name="auth_method" type="'header' | 'querystring'" default="header"}
  认证方式。仅在 `enable_auth=True` 时有效
  - `header`: 从 Authorization header 中提取 token
  - `querystring`: 从 query parameter 中提取 token
  ::
::
